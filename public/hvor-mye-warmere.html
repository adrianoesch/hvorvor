<html>
<head>
<link rel="icon" href="favicon.png">
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQT5f94LsmFh2O4dn_HlQe0pQQMoUWUmM&libraries=places"></script>
<style>
body{
  width:700px;
  margin: 60px auto;
  font-family: helvetica;
  color: black;
  padding: 20px;
}
a{
  color:inherit;
}
.label{
  width:150px;
  display: inline-block;
  font-size: 20px;
}
input{
  padding: 5px 10px;
  font-size: 20px;
}
select{
  font-size: 20px;
  font-weight: 300;
}
</style>
</head>
<body>
<div id="container">
  <h1 style="font-size:43px;">Hvor mye varmere har din hjemby blitt siden du ble født?</h1>
  <p><span class="label">Fødselsår:</span><select></select></p>
  <p><span class="label">Hiemby:</span><input type='text' size="40" value=''></input></p>
  <div id='response'>
    <div id='text'></div>
    <div id='chart'></div>
  </div>
<div>
</body>
<script>
// const GET = async (url) => {
//   let headers = new Headers();
//   headers.append('Authorization', 'Basic ' + window.btoa('03ab12fc-6478-461d-a86a-e1d5a3bc9cd0'));
//   headers.append('Access-Control-Allow-Credentials', 'true');
//   const response = await fetch(url,{
//       method:'GET',
//       headers: headers
//     });
//   const json = await response.json();
//   return(json);
// }

function update_year(e){
  current_year = e.target.value;
  update(current_place,current_year)
};

function update_place(place){
  var place = autocomplete.getPlace();
  var location = place.geometry.location;
  var location = {lat:location.lat(),lng:location.lng()};
  current_location = location;
  update(current_location,current_year)
};

function update(location,year){
  // infowindow.close();
  // marker.setVisible(false);

  year = birthYearInput.value
  if (year==''){
    alert('Pleases select birth year.')
    return
  }
  fetch('/',{
      method:'GET',
      params:{
        lat:location.lat,
        lng:location.lng,
        year:year
      }
    }).then(r=>r.json()).then(

    );

}

function init(){
  // populate birth year options
  for(let i=1920;i<2019;i++){
    var el = document.createElement("option");
    el.textContent = i.toString();
    el.value = i;
    birthYearInput.appendChild(el);
  };
  var el = document.createElement("option");
  el.value = '';
  el.textContent = '';
  birthYearInput.appendChild(el);
  birthYearInput.onchange = update_year
  birthYearInput.value = ''
  autocomplete.setFields(['address_components', 'geometry', 'icon', 'name']);
  autocomplete.setComponentRestrictions({'country':'NO'});
  autocomplete.addListener('place_changed', update_place)
};


var current_year,current_location;
var birthYearInput = document.querySelector('select');
var locationInput = document.querySelector('input');
var autocomplete = new google.maps.places.Autocomplete(locationInput);

init();



</script>
</html>

<!-- use day instead of year -->
